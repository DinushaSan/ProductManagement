pipeline {
    agent any

    triggers {
        pollSCM '* * * * *' // Polls for changes in SCM every minute
    }
    
    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package' // Compiles and packages the application
            }
        }
        stage('Test') {
            steps {
                sh 'mvn test' // Runs the test cases
            }
        }
        stage('Build Docker image') {
            steps {
                sh 'docker build -t dinushasan/product-management-tool:latest .' // Builds a Docker image for the app
            }
        }
        stage('Push Docker image') {
            environment {
                DOCKER_HUB_LOGIN = credentials('dinushasan') // Uses stored Docker Hub credentials
            }
            steps {
                sh 'docker login'
                sh 'docker dinushasan/product-management-tool:latest' // Pushes the Docker image to Docker Hub
            }
        }
    }
}


